{"investigator":"investigator-5","timestamp":"2026-02-20T16:25:00Z","type":"adversarial_challenge","id":"AC5-01","title":"CHALLENGE: This is NOT a single bug -- it is a cluster of 3 distinct problems with different fixes","challenge":"The bug report says 'ISA deep research output not nicely presented'. This is vague and conflates multiple independent issues. Based on forensic evidence from session 260220-prime-falls, this is actually: (A) an agent instruction compliance failure -- the agent never wrote isa-research-output.md despite explicit instructions, (B) a Stage 5 inline output problem -- the agent produced a 2-sentence summary instead of the full research, (C) stage gate validation is advisory-only -- all required fields were missing but pipeline continued anyway. The RENDERER is NOT broken. It already renders markdown beautifully.","evidence":"See detailed findings AC5-02 through AC5-08 below.","confidence":"high"}
{"investigator":"investigator-5","timestamp":"2026-02-20T16:26:00Z","type":"finding","id":"AC5-02","title":"CRITICAL FINDING: The .md output file was NEVER created -- this is agent non-compliance, not a renderer bug","evidence":"Searched sessions/260220-prime-falls/ recursively for any .md files: zero results. Searched session.jsonl for 'isa-research-output.md': zero matches. Searched for any Write tool usage or file writing in the session: zero matches. The agent NEVER attempted to create the output file. AGENT.md Stage 5 (lines 402-407) explicitly instructs: 'Write the complete formatted answer as a markdown file / Save to the working directory as isa-research-output.md'. The agent ignored this instruction entirely. This is not a UI bug -- it is an LLM instruction compliance failure.","confidence":"high","source":"sessions/260220-prime-falls/ (glob *.md = 0 results), session.jsonl (grep isa-research-output = 0 matches, grep write/file = 0 matches)"}
{"investigator":"investigator-5","timestamp":"2026-02-20T16:27:00Z","type":"finding","id":"AC5-03","title":"FINDING: Final user-visible message is a 2-sentence teaser, not the full research output","evidence":"session.jsonl line 31 shows the final assistant message: 'Research pipeline complete. The output covers the full picture you asked for -- from the three ISA 540 testing approaches, through actuarial expert considerations under ISA 620, to the specific documentation requirements under ISA 230 and ISA 540.35-37. Would you like me to dive deeper into any particular area -- for example, the management bias indicators, sensitivity analysis approaches, or IFRS 17 disclosure considerations?' This is a 2-sentence summary + follow-up prompt. The full research content may have been delivered inline during earlier turns (stages 3-5), but the final user-facing message is brief.","confidence":"high","source":"sessions/260220-prime-falls/session.jsonl:31 (msg-1771579758800-bi2oc9)"}
{"investigator":"investigator-5","timestamp":"2026-02-20T16:28:00Z","type":"finding","id":"AC5-04","title":"FINDING: The renderer DOES support full Markdown -- this hypothesis is ELIMINATED","evidence":"ChatDisplay.tsx lines 1871-1911: Assistant messages render through <CollapsibleMarkdownProvider><Markdown mode={renderMode} collapsible>{message.content}</Markdown>. The Markdown component (from @craft-agent/ui) supports headings, bold, lists, tables, code blocks, links via react-markdown + remarkGfm. TurnCard ResponseCard has a 540px max-height but includes a fullscreen expand button (Maximize2). So rich formatted content CAN be displayed. The renderer is not the bottleneck.","confidence":"high","source":"apps/electron/src/renderer/components/app-shell/ChatDisplay.tsx:1871-1911, packages/ui/src/components/markdown/"}
{"investigator":"investigator-5","timestamp":"2026-02-20T16:29:00Z","type":"finding","id":"AC5-05","title":"FINDING: No outer agent relay problem -- ISA agent IS the primary agent (hypothesis ELIMINATED)","evidence":"session.jsonl line 2 shows user message: '[agent:C:\\dev\\deving\\agentnative:isa-deep-research] What should i consider in context of testwork and documentation when testing insurance reserves'. The [agent:...] prefix is the Craft Agent convention for direct agent activation. All ISA tool calls (stage gates, KB searches, web searches) are at the top level of the session, not nested inside any Task tool wrapper. The agent response goes directly to the session message stream. There is NO outer agent summarizing or filtering the output.","confidence":"high","source":"sessions/260220-prime-falls/session.jsonl:2 (user msg with [agent:...] prefix), all tool calls at session top level"}
{"investigator":"investigator-5","timestamp":"2026-02-20T16:30:00Z","type":"finding","id":"AC5-06","title":"CRITICAL: Stage gate validation is ADVISORY ONLY -- every single stage had missing required fields but pipeline continued","evidence":"Every stage completion in the session had validationWarnings for missing required fields: Stage 0: 'query_plan: required field missing'. Stage 1: 'websearch_calibration: required field missing'. Stage 2: 'retrieval_summary.total_paragraphs_found/unique_after_dedup/standards_covered: required field missing'. Stage 3: 'synthesis: required field missing', 'citations_used: required field missing'. Stage 4: 'verification_scores: required field missing', 'all_passed: required field missing'. Stage 5: 'answer_delivered: required field missing' (agent used 'output_delivered' instead). Despite ALL of these, the stage gate returned 'allowed: true' for every subsequent stage. The stageOutputSchemas in config.json define required fields but they are never enforced as blocking errors.","confidence":"high","source":"sessions/260220-prime-falls/session.jsonl (lines 4,10,24,26,28,30 -- all stage completions), agents/isa-deep-research/config.json:88-111"}
{"investigator":"investigator-5","timestamp":"2026-02-20T16:31:00Z","type":"finding","id":"AC5-07","title":"FINDING: Stage 5 output data confirms no file was written and wrong field names used","evidence":"Stage 5 completion data (stage5_output.json) contains: output_delivered:true (should be answer_delivered), sections array with 7 items, kb_limitation_noted:true, standards_referenced with 6 ISAs. MISSING: output_file_path (required by AGENT.md), total_citations, verification_summary. The agent completed Stage 5 without writing the file and without providing the required output structure.","confidence":"high","source":"sessions/260220-prime-falls/data/agents/isa-deep-research/runs/run-001/evidence/intermediates/stage5_output.json"}
{"investigator":"investigator-5","timestamp":"2026-02-20T16:32:00Z","type":"root_cause_analysis","id":"AC5-08","title":"ROOT CAUSE: 3 independent problems compound to create the user experience complaint","analysis":"The user complaint 'output not nicely presented + want .md file link' decomposes into 3 distinct root causes requiring different fixes: (1) AGENT NON-COMPLIANCE with Stage 5 file-write instruction: The agent never called Write to create isa-research-output.md. It also used wrong field names (output_delivered vs answer_delivered). Fix: Either enforce via stage gate (block completion if output_file_path missing) OR programmatically create the file in the stage completion handler. (2) INLINE OUTPUT TOO BRIEF: The agent produced a 2-sentence summary as the final message instead of the full structured research with progressive disclosure, citations, and verification table. Fix: Strengthen AGENT.md Stage 5 instructions -- explicitly state the full synthesis from Stage 3 must be the inline response text, not just a summary. Add: 'Your final response MUST include the complete formatted research, not a summary.' (3) STAGE GATE SOFT VALIDATION: validationWarnings logged but never blocked progression. This allowed systematic non-compliance across all 6 stages. Fix: Add configurable enforcement mode to stageOutputSchemas (warn vs block). The RENDERER IS NOT THE PROBLEM. It supports full Markdown, fullscreen expand, and file path links. The bottleneck is entirely agent behavior + stage gate permissiveness.","confidence":"high","fixes_needed":["AGENT.md Stage 5: Add explicit instruction that full research must be inline, not just summary","AGENT.md Stage 5: Change file reference to use absolute path (./isa-research-output.md) so FILE_PATH_REGEX detects it","Stage gate: Make stageOutputSchemas enforcement configurable (warn vs block)","Stage gate: Specifically validate output_file_path exists in Stage 5 data before allowing completion"]}
